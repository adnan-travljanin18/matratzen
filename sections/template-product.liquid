<style>
    /* Magnifying glass container */
    .img-magnifier-container {
        position: relative;
        cursor: none;
    }

    /* Magnifying glass icon */
    .img-magnifier-glass {
        position: absolute;
        border: 3px solid #131e27;
        border-radius: 50%;
        cursor: none;
        width: 15rem; /* Set the size of the magnifying glass */
        height: 15rem;
        pointer-events: none; /* Make sure magnifying glass does not interfere with mouse events on the image */
        display: none; /* Initially hidden */
    }
    .metafield-rich_text_field ul {
        padding-left: 1rem !important;
        padding-bottom: 0px !important;
        margin-bottom: 0px !important;
    }
    .metafield-rich_text_field li::marker {
        color: #131e27;
    }
    .metafield-rich_text_field li {
        margin-bottom: 4px;
    }
    .swiper-pagination {
        top: 10px !important;
    }
    .swiper-pagination-bullet {
        width: 60px;
        border-radius: 0;
        height: 2px;
        background: #cfd8dc;
    }
    .swiper-pagination-bullet-active {
        background: #263238;
    }
</style>
<div
    data-section-id="{{ section.id }}"
    data-template="product"
    class="{% if product.has_only_default_variant %}only-default-variant{% endif %}"
>
    {%- liquid
        assign productExcludeTag = settings.product_exclude_tag_text
        assign fluid_layout = section.settings.fluid_layout
        assign current_variant = product.selected_or_first_available_variant
        assign featured_image = current_variant.featured_image | default: product.featured_image

        capture current
            cycle 1, 2
        endcapture
    -%}
    <section class="section-content" data-product-container>
        <div class="{% if fluid_layout %}container-fluid{% else %}container{% endif %}">
            <div class="row">
                <div class="col-lg-8">
                    <div data-type="slider" class="product-images-wrapper pr-lg-4 text-center">
                        {% if section.settings.template_type == 'classic-vertical' %}
                            <div class="row">
                        {% endif %}
                        {% if featured_image != blank %}
                            <a
                                class="skip-to-content-link button visually-hidden-skip"
                                href="#ProductInfo-{{ section.id }}"
                            >
                                {{ 'accessibility.skip_to_product_info' | t }}
                            </a>
                            <slider-element
                                class="swiper-container {% if section.settings.template_type == 'classic-vertical' %} col-md-10 order-md-2 {% endif %}"
                                data-main-slider
                            >
                                <div
                                    class="swiper swiper-slider product-carousel pdp-carousel"
                                    data-nav="product-thumbnails"
                                    data-slider='
                                        {
                                            "loop": true,
                                            "slidesPerView": "1",
                                            "spaceBetween": 15,
                                            "grabCursor": true,
                                            "navigation": {
                                                "nextEl": ".swiper-button-next",
                                                "prevEl": ".swiper-button-prev"
                                            },
                                            "pagination": {
                                                "el": ".swiper-pagination"
                                            }
                                        }
                                    '
                                    role="tree"
                                >
                                    <div class="swiper-wrapper">
                                        {% for media in product.media %}
                                            {% if media.media_type == 'image' %}
                                                {% assign image = media %}
                                                <div
                                                    class="swiper-slide carousel-cell d-flex align-items-center product--media"
                                                    data-mediaID="{{ image.id }}"
                                                    role="treeitem"
                                                >
                                                    <div
                                                        class="swiper-zoom-container img-magnifier-container"
                                                    >
                                                        <img
                                                            id="myimage"
                                                            src="{{ image.src | image_url }}"
                                                            {% if forloop.index != 1 %}
                                                                loading="lazy"
                                                            {% else %}
                                                                fetchpriority="high"
                                                            {% endif %}
                                                            data-variant-title="{{ image.alt | escape }}"
                                                            alt="{{ image.alt | escape }}"
                                                            width="{{ image.src.width }}"
                                                            height="{{ image.src.width | divided_by: image.src.aspect_ratio | round }}"
                                                        >
                                                        <script></script>
                                                    </div>
                                                </div>
                                            {% elsif media.media_type == 'external_video'
                                                or media.media_type == 'video'
                                            %}
                                                <div
                                                    class="swiper-slide carousel-cell d-flex align-items-center product--media"
                                                    data-mediaID="{{ media.id }}"
                                                    role="treeitem"
                                                >
                                                    {%- render 'media', media: media -%}
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                    <div class="slider-navigation-wrapper col-12">
                                        <div
                                            class="template-product swiper-button-prev"
                                            {% if product.images.size <= 1 %}
                                                style="display: none !important;"
                                            {% endif %}
                                            id="slide-prev-button"
                                        ></div>
                                        <div
                                            class="template-product swiper-button-next"
                                            {% if product.images.size <= 1 %}
                                                style="display: none !important;"
                                            {% endif %}
                                            id="slide-next-button"
                                        ></div>
                                    </div>
                                </div>
                                <div class="swiper-pagination position-relative"></div>
                            </slider-element>

                            <!-- Nav Slider functionality is not available directly. Custom Set up for Nav -->
                            {% if product.images.size > 1 %}
                                <div
                                    class="d-none d-md-block swiper-container  {% if section.settings.template_type == 'classic-vertical' %}col-md-2 order-md-1{% endif %}"
                                    data-thumbSlider
                                    data-direction="{% if section.settings.template_type == 'classic-vertical' %}vertical{% else %}horizontal{% endif %}"
                                >
                                    <div
                                        class="swiper swiper-slider product-thumbnails"
                                        data-slider='
                                            {
                                                "direction":"horizontal",
                                                "loop": false,
                                                "slidesPerView": "5",
                                                "spaceBetween": 10,
                                                "grabCursor": true,
                                                "slideToClickedSlide": true,
                                                "breakpoints": {
                                                  "768": {
                                                    "direction":"{% if section.settings.template_type == 'classic-vertical' %}vertical{%else%}horizontal{% endif %}",
                                                    "slidesPerView": "6",
                                                    "spaceBetween": 15
                                                  }
                                              }
                                            }
                                        '
                                        role="tree"
                                    >
                                        <div class="swiper-wrapper">
                                            {% for media in product.media %}
                                                {% if media.media_type == 'image' %}
                                                    {% assign image = media %}
                                                    <div
                                                        class="swiper-slide product-thumb--image"
                                                        data-index="{{ forloop.index }}"
                                                        data-mediaID="{{ image.id }}"
                                                        role="treeitem"
                                                    >
                                                        <img
                                                            class="img-fluid"
                                                            src="{{ image.src | image_url }}"
                                                            srcset="{{ image.src | image_url: width: 250 }}"
                                                            sizes="250px"
                                                            loading="lazy"
                                                            width="{{ image.width }}"
                                                            height="{{ image.width | divided_by: image.aspect_ratio }}"
                                                            alt="{{ image.alt | default: product.title | escape }}"
                                                        >
                                                    </div>
                                                {% elsif media.media_type == 'external_video'
                                                    or media.media_type == 'video'
                                                %}
                                                    <div
                                                        class="swiper-slide product-thumb--image media--video"
                                                        data-index="{{ forloop.index }}"
                                                        data-mediaID="{{ media.id }}"
                                                        role="treeitem"
                                                    >
                                                        <img
                                                            class="img-fluid"
                                                            src="{{ media.preview_image.src | image_url }}"
                                                            srcset="{{ media.preview_image.src | image_url: width: 250 }}"
                                                            sizes="250px"
                                                            loading="lazy"
                                                            width="{{ media.preview_image.width }}"
                                                            height="{{ media.preview_image.width | divided_by: media.preview_image.aspect_ratio }}"
                                                            alt="{{ media.alt | default: product.title | escape }}"
                                                        >
                                                        <span class="icon-play position-absolute"></span>
                                                    </div>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% else %}
                            {{ 'image' | append: current | placeholder_svg_tag: 'img-fluid' }}
                        {% endif %}
                        {% if section.settings.template_type == 'classic-vertical' %}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <div class="col-lg-4" id="ProductInfo-{{ section.id }}">
                    <div
                        class="product-details-wrapper mt-5 mt-lg-0"
                        data-slider_type="{{ section.settings.slider_type }}"
                    >
                        <div class="row">
                            {% render 'breadcrumbs' %}
                        </div>
                        <div class="heading-wrapper">
                            <h1>{{ product.title }}</h1>
                            <div
                                class="product-wishlist-button"
                            >
                                {% render 'hulkapps-wishlist-collection-btn',
                                    productId: product.id,
                                    variantId: product.selected_or_first_available_variant.id,
                                    buttonClass: 'wishlisthero-floating'
                                %}
                            </div>
                        </div>
                        {%- for block in section.blocks -%}
                            {%- case block.type -%}
                                {%- when '@app' -%}
                                    {% render block %}
                                {%- when 'subtitle' -%}
                                    {% if block.settings.subtitle != '' %}
                                        <div class="align-items-center mt-2">
                                            {{ block.settings.subtitle }}
                                        </div>
                                    {% endif %}
                                {%- when 'vendor' -%}
                                    {% assign show_vendor = block.settings.show_vendor %}
                                    <div class="align-items-center">
                                        {% if show_vendor %}
                                            <span class="my-0">{{ product.vendor }}</span>
                                        {% endif %}
                                    </div>
                                {%- when 'price' -%}
                                    <div class="price-wrapper mt-2">
                                        <span class="h5 actual-price money" data-currentPrice>
                                            {{- current_variant.price | money -}}
                                        </span>
                                        {%- if current_variant.compare_at_price > current_variant.price -%}
                                            <s class="h6 mr-2 money" data-comparePrice>
                                                {{- current_variant.compare_at_price | money -}}
                                            </s>
                                        {%- endif -%}
                                    </div>
                                    {%- form 'product',
                                        product,
                                        data-productid: product.id,
                                        id: 'product-form-installment',
                                        class: 'installment caption-large mt-4'
                                    -%}
                                        <input
                                            type="hidden"
                                            name="id"
                                            data-productid="{{ product.id }}"
                                            value="{{ product.selected_or_first_available_variant.id }}"
                                        >
                                        {{ form | payment_terms }}
                                    {%- endform -%}
                                {%- when 'description' -%}
                                    {% if product.metafields.custom.bullet_points != blank %}
                                        <div class="rte short-description">
                                            {{ product.metafields.custom.bullet_points | metafield_tag }}
                                        </div>
                                    {% else %}
                                        <div style="padding: 4.5rem 0; display: block;"></div>
                                    {% endif %}
                                {%- when 'product-tabs' -%}
                                    {%- liquid
                                        if block.settings.enable_product_tabs and section.settings.product_tabs_placement == 'beside_slider'
                                            render 'block-product-tabs'
                                        endif
                                    -%}
                                {%- when 'product_form' -%}
                                    {%- liquid
                                        unless product.tags contains productExcludeTag
                                            render 'form-product', product: product, current_variant: current_variant, format: 'product-page'
                                        endunless
                                    -%}
                                {%- when 'share' -%}
                                    {% if block.settings.show_social_share %}
                                        <div class="d-flex align-items-center mt-4 share-wishlist-container">
                                            {% render 'social-sharing',
                                                share_title: product.title,
                                                share_permalink: product.url,
                                                share_image: product
                                            %}
                                        </div>
                                    {% endif %}
                            {%- endcase -%}
                        {%- endfor -%}
                    </div>
                </div>
            </div>
        </div>
    </section>

    {%- liquid
        for block in section.blocks
            case block.type
                when 'product-tabs'
                    if block.settings.enable_product_tabs and section.settings.product_tabs_placement == 'below_slider'
                        render 'block-product-tabs', block: block
                    endif

                when 'layer-slider'
                    if block.settings.enable_layer_slider
                        render 'block-product-layer-slider', block: block
                    endif

                when 'icon-description'
                    if block.settings.enable_icon_description
                        render 'block-product-icon-description', block: block
                    endif

                when 'related-products'
                    if block.settings.enable_related_products
                        render 'block-related-products', block: block
                    endif
            endcase
        endfor
    -%}
</div>

<script type="application/json" data-productMedia>
    {{ product.media | json }}
</script>
<script>
    // Remove the 'swiper-button-disabled' class from the next button
    document.addEventListener('DOMContentLoaded', function () {
        var nextButton = document.getElementById('slide-next-button');
        if (nextButton) {
            nextButton.classList.remove('swiper-button-disabled');
            nextButton.removeAttribute('aria-disabled');
        }
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Function to initialize magnifying glass for a specific image
        function initializeMagnifier(img) {
            // Create a magnifying glass element
            var glass = document.createElement('div');
            glass.className = 'img-magnifier-glass';
            img.parentElement.insertBefore(glass, img.nextSibling);

            // Set background image of magnifying glass to be the same as the image
            glass.style.backgroundImage = "url('" + img.src + "')";

            // Set background size and position to match the image size
            glass.style.backgroundSize = img.width * 2.2 + 'px ' + img.height * 2.2 + 'px';
            glass.style.backgroundPosition = 'center';

            function moveMagnifier(e) {
                // Calculate the position of the magnifying glass
                var pos = getCursorPos(e);
                var x = pos.x - glass.offsetWidth / 2.2;
                var y = pos.y - glass.offsetHeight / 2.2;

                // Calculate the background position to center the zoomed content with the cursor
                var bgPosX = (pos.x - img.offsetLeft) * 2.2 - glass.offsetWidth / 2.2;
                var bgPosY = (pos.y - img.offsetTop) * 2.2 - glass.offsetHeight / 2.2;

                // Prevent the magnifying glass from being positioned outside the image
                if (x < 0) {
                    x = 0;
                    bgPosX = 0;
                }
                if (x > img.width - glass.offsetWidth) {
                    x = img.width - glass.offsetWidth;
                    bgPosX = img.width * 2 - glass.offsetWidth;
                }
                if (y < 0) {
                    y = 0;
                    bgPosY = 0;
                }
                if (y > img.height - glass.offsetHeight) {
                    y = img.height - glass.offsetHeight;
                    bgPosY = img.height * 2 - glass.offsetHeight;
                }

                // Set the position of the magnifying glass
                glass.style.left = x + img.offsetLeft + 'px';
                glass.style.top = y + img.offsetTop + 'px';

                // Set background position of the magnifying glass to center zoomed content with the cursor
                glass.style.backgroundPosition = '-' + bgPosX + 'px -' + bgPosY + 'px';
            }

            // Function to get the cursor position
            function getCursorPos(e) {
                var a,
                    x = 0,
                    y = 0;
                e = e || window.event;

                // Get the x and y positions of the image
                a = img.getBoundingClientRect();

                // Calculate the cursor's x and y coordinates relative to the image
                x = e.pageX - a.left;
                y = e.pageY - a.top;

                // Consider any page scrolling
                x = x - window.pageXOffset;
                y = y - window.pageYOffset;
                return { x: x, y: y };
            }

            // Add event listeners for mousemove and mouseout to show and hide the magnifying glass
            img.addEventListener('mousemove', function (e) {
                moveMagnifier(e);
                glass.style.display = 'block';
            });

            img.addEventListener('mouseout', function () {
                glass.style.display = 'none';
            });
        }

        // Find all images with the id "myimage" and initialize magnifying glass for each of them
        var images = document.querySelectorAll('#myimage');
        images.forEach(function (img) {
            initializeMagnifier(img);
        });
    });
</script>

{% schema %}
{
    "name": "t:sections.template-product.name",
    "tag": "section",
    "class": "product-section spaced-section",
    "blocks": [
        {
            "type": "@app"
        },
        {
            "type": "vendor",
            "name": "Vendor",
            "limit": 1,
            "settings": [
                {
                    "type": "checkbox",
                    "id": "show_vendor",
                    "default": true,
                    "label": "Show Vendor"
                }
            ]
        },
        {
            "type": "price",
            "name": "Price",
            "limit": 1
        },
        {
            "type": "product_form",
            "name": "Product Form",
            "limit": 1
        },
        {
            "type": "description",
            "name": "Description",
            "limit": 1
        },
        {
            "type": "subtitle",
            "name": "SubTitle",
            "limit": 1,
            "settings": [
                {
                    "type": "richtext",
                    "id": "subtitle",
                    "label": "SubTitle"
                }
            ]
        },
        {
            "type": "share",
            "name": "Share",
            "limit": 1,
            "settings": [
                {
                    "type": "checkbox",
                    "id": "show_social_share",
                    "default": true,
                    "label": "Show Social Sharing"
                }
            ]
        },
        {
            "type": "product-tabs",
            "name": "Product Tabs",
            "limit": 1,
            "settings": [
                {
                    "type": "header",
                    "content": "Layout"
                },
                {
                    "type": "checkbox",
                    "id": "enable_product_tabs",
                    "label": "Enabled?",
                    "default": true
                },
                {
                    "type": "checkbox",
                    "id": "product_tabs_fluid_layout",
                    "label": "Full Width Layout?",
                    "default": false
                },
                {
                    "type": "select",
                    "id": "product_tabs_layout",
                    "label": "Product Tabs Layout",
                    "options": [
                        {
                            "value": "tabify",
                            "label": "Tabify"
                        },
                        {
                            "value": "accordion",
                            "label": "Accordion"
                        }
                    ],
                    "default": "tabify"
                },
                {
                    "type": "header",
                    "content": "Tabs"
                },
                {
                    "type": "checkbox",
                    "id": "enable_descripion_tab",
                    "label": "Enable Description Tab?",
                    "default": true
                },
                {
                    "type": "checkbox",
                    "id": "enable_custom_tab_1",
                    "label": "Enable Custom Tab 1?"
                },
                {
                    "type": "text",
                    "id": "tab_1_title",
                    "label": "Tab 1 Title",
                    "default": "Tab Title 1"
                },
                {
                    "type": "checkbox",
                    "id": "enable_custom_tab_2",
                    "label": "Enable Custom Tab 2?"
                },
                {
                    "type": "text",
                    "id": "tab_2_title",
                    "label": "Tab 2 Title",
                    "default": "Tab Title 2"
                },
                {
                    "type": "richtext",
                    "id": "tab_2_content",
                    "label": "Tab 2 Content"
                }
            ]
        },
        {
            "type": "related-products",
            "name": "Related Products",
            "limit": 1,
            "settings": [
                {
                    "type": "header",
                    "content": "Layout"
                },
                {
                    "type": "checkbox",
                    "id": "enable_related_products",
                    "label": "Enabled?"
                },
                {
                    "type": "checkbox",
                    "id": "related_products_fluid_layout",
                    "label": "Full Width Layout?",
                    "default": false
                },
                {
                    "type": "range",
                    "id": "related_products_view",
                    "label": "Total Items to Show",
                    "min": 0,
                    "max": 16,
                    "step": 1,
                    "default": 9
                },
                {
                    "type": "range",
                    "id": "related_products_auto_play",
                    "label": "Autoplay",
                    "info": "Duration of animation between slides (in seconds). Set to zero if you don't want the slider to autoplay.",
                    "min": 0,
                    "max": 10,
                    "step": 1,
                    "default": 0
                },
                {
                    "type": "header",
                    "content": "Content"
                },
                {
                    "type": "textarea",
                    "id": "related_products_heading_txt",
                    "label": "Heading Text",
                    "default": "Related Products"
                },
                {
                    "type": "select",
                    "id": "product_type",
                    "label": "Product Type",
                    "options": [
                        {
                            "value": "product-recommendations",
                            "label": "Product Recommendations"
                        },
                        {
                            "value": "related-products",
                            "label": "Related Products"
                        }
                    ],
                    "default": "product-recommendations"
                },
                {
                    "type": "paragraph",
                    "content": "Product Recommendations: Products comes from Shopify."
                },
                {
                    "type": "paragraph",
                    "content": "Related Products: Products which belongs to same collection."
                },
                {
                    "type": "header",
                    "content": "Styling"
                },
                {
                    "type": "color",
                    "id": "related_products_section_bg_color",
                    "label": "Background Color",
                    "default": "#FAFAF7"
                },
                {
                    "type": "color",
                    "id": "related_products_section_color",
                    "label": "Text Color",
                    "default": "#343a40"
                }
            ]
        },
        {
            "type": "layer-slider",
            "name": "Layer Slider",
            "limit": 1,
            "settings": [
                {
                    "type": "checkbox",
                    "id": "enable_layer_slider",
                    "label": "Enable Custom Layer Slider"
                }
            ]
        },
        {
            "type": "icon-description",
            "name": "Icon Description",
            "limit": 1,
            "settings": [
                {
                    "type": "checkbox",
                    "id": "enable_icon_description",
                    "label": "Enable Custom Icons & Description"
                }
            ]
        }
    ],
    "settings": [
        {
            "type": "header",
            "content": "Template"
        },
        {
            "type": "select",
            "id": "template_type",
            "label": "Template Type",
            "options": [
                {
                    "value": "classic-horizontal",
                    "label": "Classic: Horizontal Thumbs"
                },
                {
                    "value": "classic-vertical",
                    "label": "Classic: Vertical Thumbs"
                }
            ],
            "default": "classic-horizontal"
        },
        {
            "type": "paragraph",
            "content": "Classic Horizontal Thumbs: Product Thumbnails below."
        },
        {
            "type": "paragraph",
            "content": "Classic Vertical Thumbs: Product Thumbnails on Left."
        },
        {
            "type": "header",
            "content": "Layout"
        },
        {
            "type": "checkbox",
            "id": "fluid_layout",
            "label": "Full Width Layout?",
            "default": false
        },
        {
            "type": "header",
            "content": "Features"
        },
        {
            "type": "checkbox",
            "id": "show_vendor",
            "label": "Show Vendor?",
            "default": true
        },
        {
            "type": "checkbox",
            "id": "enable_dynamic_checkout",
            "label": "Enable Dynamic checkout Buttons?",
            "default": false,
            "info": "Using the payment methods available on your store, customers see their preferred option, like PayPal or Apple Pay. [Learn more](https:\/\/help.shopify.com\/manual\/using-themes\/change-the-layout\/dynamic-checkout)"
        },
        {
            "type": "select",
            "id": "product_tabs_placement",
            "label": "Product Tabs Placement",
            "options": [
                {
                    "value": "beside_slider",
                    "label": "Beside Product Slider"
                },
                {
                    "value": "below_slider",
                    "label": "Below Product Slider"
                }
            ],
            "default": "below_slider"
        }
    ]
}
{% endschema %}
